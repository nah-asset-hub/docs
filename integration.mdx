---
title: "Integration Guide"
description: "This page will explain the integration steps/ information for you to implement our API efficiently"
icon: "chart-network"
---

## Integration Overview

- We  currently provide REST API with OAuth 2.0 for authorization.
- We differentiate between sandbox & production API so you can safely test your implementation in sandbox mode. Sandbox environment will not initiate any real transaction and it's designed for testing purposes. Sandbox Base URL: https://api-sandbox.durian-x.com/v1.0
- Credentials needed for integration:
  - Sandbox Account - you can request account creation via our BD team \<TBC Email\>. After account creation we will share to you
    - Sandbox X-CLIENT-ID
    - Sandbox Secret Key
    - Sandbox Public key of NAH
  - Prepare Sandbox Webhook URL
  - Prepare your own Sandbox Private & Public Key. Step to generate your private key and public key is as following.

  ```shellscript
  # generate merchant's private key
  openssl genrsa -out client.key 2048
  # Generate Public Key
  openssl rsa -in rsa_private_key.pem -out rsa_public_key.pem -pubout
  ```

  _Please store your private key securely. The public key will need to be shared to NAH._
  - Request for sandbox setup to NAH. \
    To setup your sandbox settings, you can send an email to \<TBC Tech Onboarding Email\> with the following Subject: "Request for sandbox configuration". The request should include
    - Sandbox Public Key to be shared to us in encrypted file to \<TBC Tech Onboarding Email\>. Password to be shared in different channel / same channel (i.e. Email, Whatsapp, Telegram) with different PIC
    - Sandbox Webhook URL

## Transaction Flow & Sequence Diagram

### **Crypto deposit flow**

![Image](/images/image-6.png)

### **Quote & Off-Ramp Flow**

![Image](/images/image-7.png)

## Authentication and Security

### Access Token Handling

[Resources for Access Token Handling](#api-reference/introduction)

### Signature Handling

TBC

## Error Handling and Edge Cases

### Common Error

For any success case, NAH will return 2XX HTTP Code as the response, however for several error cases, NAH will return these common error as following:

| HTTP Error Code | Message               | Handling                                                     |
| --------------- | --------------------- | ------------------------------------------------------------ |
| 500             | Internal Server Error | Retry / Raise to NAH for the issue                           |
| 400             | Bad Request           | Re-check the structure of the request body                   |
| 401             | Unauthorized          | Re-check authorization handling from your end (Access Token) |

In addition to this , there will be specific error for each of the API you will access as mentioned below:

**Specific API Error**

| API            | HTTP Error Code          | Code                       | Handling                                                                                   | Sample Error                                                                       |
| -------------- | :----------------------- | :------------------------- | :----------------------------------------------------------------------------------------- | ---------------------------------------------------------------------------------- |
| Create Deposit | 400 Bad Request          | BAD_REQUEST                | Check your body request and input the supported asset                                      | "code": BAD_REQUEST<br />"message: "Invalid request Asset Network"                 |
| Create Swap    | 404 Not Found            | INSUFFICIENT_FUNDS         | Check your current account balance & deposit fund                                          | "code": INSUFFICIENT_FUNDS<br />"message: "insufficient balance on source asset"   |
| Create Swap    | 422 Unprocessable Entity | QUOTE_NOT_FOUND_OR_EXPIRED | Quote is expired/ Not found, please re-generate new quote                                  | "code": "QUOTE_NOT_FOUND_OR_EXPIRED", "message": "quoteId is invalid or expired"   |
| Create Quote   | 400 Bad Request          | QUOTE_INVALID_AMOUNT       | Quote is not within the amount limit, Please re-generate new quote within the amount limit | "code": "QUOTE_INVALID_AMOUNT", "message": "amount must be between 100 and 100000" |

### Quote Expired

In case of a quote is expired, you cannot use it for the swap transaction. Therefore you need to handle from your end to re-quote in case of expired quote

### Failure and retry points

Here's the following failure & retry point you need to handle from your end

- Rate Expired -\> We recommend you handle this by re-quote the transaction and execute it with the newest quote
- Handling timeout when requesting a transaction
  - We recommend you to get the status of the transaction.
- Handling of timeout for transaction notification
  - We currently provide webhook retry. If you have configured the webhook URL, when ack is not received by us, we will retry the webhook for 5 times with exponential interval.
  - If there are any timeout for the transaction / webhook notification, we recommend you check the status of transaction using get API to update your internal status.

## API List

| Category               | API Name                      | URL                             | Method | Description                                                                                  |
| ---------------------- | ----------------------------- | ------------------------------- | ------ | -------------------------------------------------------------------------------------------- |
| Supporting Information | Get Supported Digital Asset   | baseUrl/v1.0/assets             | GET    | Return information of digital asset supported & supporting information related to the asset  |
| Supporting Information | Get Supported Swap Pairs      | baseUrl/v1.0/pairs              | GET    | Return information of swap pairs supported                                                   |
| Authentication         | Generate Access Token         | baseUrl/v1.0/access-token       | POST   | Get access token as authentication to access transaction API                                 |
| Accounts               | Get Accounts                  | baseUrl/v1.0/accounts           | GET    | Get list of account & balance of digital asset                                               |
| Accounts               | Get Account by ID             | baseUrl/v1.0/accounts/:id       | GET    | Get single account & balance of digital asset                                                |
| Accounts               | Get Account Ledger            | baseUrl/v1.0/accounts/ledgers   | GET    | Get account transaction history and balance of the account                                   |
| Deposits               | Create Deposit Address        | baseUrl/v1.0/deposits/addresses | POST   | Returns a wallet address where merchants can deposit crypto asset for off-ramp transactions. |
| Deposits               | Get Deposit Transactions      | baseUrl/v1.0/deposits           | GET    | Return list of deposit transactions ordered from latest to oldest based on createdAt field   |
| Deposits               | Get Deposit Transaction by ID | baseUrl/v1.0/deposits/:id       | GET    | Return deposit transaction based on id                                                       |
| Quotes                 | Create Quote                  | baseUrl/v1.0/quotes             | POST   | Get swap rate from one asset to another                                                      |
| Quotes                 | Get Quotes                    | baseUrl/v1.0/quotes             | GET    | Return list of quotes                                                                        |
| Quotes                 | Get Quote by ID               | baseUrl/v1.0/quotes/:id         | GET    | Return quote by its ID                                                                       |
| Swap                   | Create Swap                   | baseUrl/v1.0/swaps              | POST   | Convert based from one asset to another based on quote ID                                    |
| Swap                   | Get Swaps                     | baseUrl/v1.0/swaps              | GET    | Return list of swaps                                                                         |
| Swap                   | Get Swap by ID                | baseUrl/v1.0/swaps/:id          | GET    | Return swap by its ID                                                                        |

## Object information:

### **1. Accounts**

Account represent a wallet/ balance for your digital asset. An Account will represent 1 digital asset per provider/CEX.

### **2. Deposits**

Deposit represent both the deposit address and the transaction. Deposit address will be generated for the digital asset, and once there's a transfer to the deposit address, deposit transaction will be created. Successful deposit will add the balance to your digital asset account

**Deposit Transaction Status Lifecycle**

<img
  src="/images/image-12.png"
  alt="Image"
  title="Image"
  style={{ width:"25%" }}
/>

| Status    | Definition                                                                                              |
| :-------- | :------------------------------------------------------------------------------------------------------ |
| completed | Deposit transaction is success and balance will be credited according to the deposit transaction amount |
| failed    | Deposit transaction is failed  and your balance will not be credited                                    |

### **3. Quotes**

Quote represent inquiring rate from the provider/ CEX. This quote can then be used to execute the swap transaction (fiat - digital asset, digital asset - fiat , digital asset - digital asset)

**Status Lifecycle**

<img
  src="/images/image-10.png"
  alt="Image"
  title="Image"
  style={{ width:"20%" }}
/>

| Status  | Definition                                   |
| :------ | :------------------------------------------- |
| active  | Quote is ready to use for transaction        |
| used    | Quote is already executed for swap           |
| expired | Quote is expired and cannot be used for swap |

### **4. Swaps**

Swap represent execution of a conversion transaction from fiat - digital asset, digital asset - fiat , digital asset - digital asset. To execute swap , you need to first quote the rate first.

**Status Lifecycle**

<img
  src="/images/image-11.png"
  alt="Image"
  title="Image"
  style={{ width:"20%" }}
/>

| Status     | Definition                                         |
| :--------- | :------------------------------------------------- |
| processing | Swap initial phase after executed                  |
| completed  | Swap is successfuly executed by the CEX / partner  |
| failed     | Swap is failed to be executed by the CEX / partner |

## Off-Ramp Integration Steps

### **0.  Credentials Preparation**

Please follow the guide for credentials preparation on the top of this page

### **1.  Authorization & Signature Handling**

- Generate Access Token

### **2.  Crypto Deposits**

- Create Deposit Address
- Deposit Transaction Webhook Handling

### **3. Quotes**

- Create Quote

### **4.  Swaps**

- Create Swap
- Swap Webhook handling

## Webhooks and Events

List of webhook event types supported in NAH side:

| Event           | When it's fired                                                         | Case      |
| --------------- | ----------------------------------------------------------------------- | --------- |
| asset.deposited | When a crypto asset is credited to your crypto account in the CEX       | Completed |
| swap.executed   | When a swap (Crypto - Fiat or Fiat - Crypto) is successfuly processed   | Completed |
| swap.executed   | When a swap (Crypto - Fiat or Fiat - Crypto) is  processed with failure | Failed    |

- Handling of timeout for webhook/transaction notification.
  - We currently provide webhook handling for Crypto Deposit transaction & Swap transaction with the following event: swap.executed , asset.deposited. If you have configured the webhook URL, when ack is not received by us, we will retry the webhook for 5 times with exponential interval.
  - If there are any timeout for the transaction, we recommend you check the status of transaction using get API for the transaction.

## How to test your implementation

- We provide sandbox environment for you to test your implementation before going live. Currently the sandbox environment is supported only via API
  - Sandbox Base URL: https://api-sandbox.durian-x.com/v1.0
- To simulate certain error cases in each of the API you can use the following Header to simulate the transaction
  - X-SANDBOX-ERROR
  - X-SIMULATE-SANDBOX-TRX

## Sandbox limitations

- For Asset API we currently always set static balance information for the transaction

## Simulating Edge Cases in Sandbox

### Crypto Deposit

| **Case Handling** | **Header Value**                                                              | **Output sample**                                                                                                                                    |
| :---------------- | :---------------------------------------------------------------------------- | :--------------------------------------------------------------------------------------------------------------------------------------------------- |
| Simulate success  | Header<br />X-SANDBOX-DEPOSIT = 100.1<br />X-SIMULATE-SANDBOX-TRX = completed | status code 200 OK<br /><br />In Deposit transaction, it will be marked as completed, Crypto deposit webhook will be sent to sandbox webhook url set |
| Simulate Failed   | Header<br />X-SANDBOX-DEPOSIT = 100.1<br />X-SIMULATE-SANDBOX-TRX = failed    | status code 200 OK<br /><br />In Deposit transaction, it will be marked as failed, Crypto deposit webhook will be sent to sandbox webhook url set    |

### Quote

| **Case Handling**    | **Header Value**                            | **Output sample** |
| :------------------- | :------------------------------------------ | :---------------- |
| Simulate success     | Any                                         | status code 201   |
| Invalid Quote Amount | Header Any.<br />Body: Set sourceAmount = 1 | status code 400   |

### Swap

| **Case Handling**             | **Header Value**                        | **Output Sample**                                                                                                                                      |
| :---------------------------- | :-------------------------------------- | :----------------------------------------------------------------------------------------------------------------------------------------------------- |
| Simulate Success              | without header value of X-SANDBOX-ERROR | status code 202<br /><br />In Swap transaction, it will be marked as success, swap executed webhook: completed will be sent to the sandbox webhook url |
| Simulate Insufficient Balance | X-SANDBOX-ERROR = INSUFFICIENT_BALANCE  | status code 422<br /><br />In Swap transaction, it will be marked as failed, swap executed webhook: failed will be sent to the sandbox webhook url     |
| Simulate Token is Expired     | X-SANDBOX-ERROR = QUOTE_EXPIRED         | status code 404<br /><br />In Swap transaction, it will be marked as failed, swap executed webhook: failed will be sent to the sandbox webhook url     |

[Quickstart guide](/quickstart)