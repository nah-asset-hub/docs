---
title: "Integration Guide"
icon: "chart-network"
---

## Credentials Preparation

- NAH  provide REST API with OAuth 2.0 for authorization.
- NAH differentiate between sandbox & production API so you can safely test your implementation in sandbox mode. Sandbox environment will not initiate any real transaction and it's designed for testing purposes.
- Sandbox Base URL: https://api-sandbox.durian-x.com/v1.0
- Credentials needed for integration:
  - Sandbox Account - you can request account creation via our BD team [sales@durian-x.com](mailto:sales@durian-x.com). After account creation we will share to you
    - Sandbox X-CLIENT-ID
    - Sandbox Secret Key
    - Sandbox Public key of NAH
  - Prepare Sandbox Webhook URL
  - Prepare your own Sandbox Private & Public Key. To generate your private key and public key, please follow this [link](/api-reference/authentication#credential-setup). We highly recommend to differentiate sandbox and production key.

  _Please store your private key securely. The public key will need to be shared to NAH._
  - Request for sandbox setup to NAH. \
    To setup your sandbox settings, you can send an email to [support@durian-x.com](mailto:support@durian-x.com) with the following Subject: "Request for sandbox configuration". The request should include
    - Sandbox Public Key to be shared to us in encrypted file to \<TBC Tech Onboarding Email\>. Password to be shared in different channel / same channel (i.e. Email, Whatsapp, Telegram) with different PIC
    - Sandbox Webhook URL

## Webhooks and Events

List of webhook event types supported in NAH side:

| Event           | When it's fired                                                         | Case      |
| :-------------- | :---------------------------------------------------------------------- | :-------- |
| asset.deposited | When a crypto asset is credited to your crypto account in the CEX       | Completed |
| swap.executed   | When a swap (Crypto - Fiat or Fiat - Crypto) is successfuly processed   | Completed |
| swap.executed   | When a swap (Crypto - Fiat or Fiat - Crypto) is  processed with failure | Failed    |

[Link for Webhook Handling](/api-reference/api-reference/transaction-notification-webhook)

## Off-Ramp Integration Steps

### 1. Generate Access Token

1. Generate Access Token Signature as header information in access token API (X-Signature). [Link for Access Token X-Signature Header](/api-reference/authentication#generate-signature-to-obtain-access-token-b2b)
2. Hit Access Token API with proper header request. [Link for Access Token generation sample](/api-reference/authentication#generate-access-token)

**Request Sample**

```text
curl --location 'https://api-sandbox.durian-x.com/v1.0/access-token' \
--header 'Content-Type: application/json' \
--header 'Authorization: Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJjZXhfYWdncmVnYXRvcl9zZXJ2aWNlIiwiZXhwIjoxNzcwMDQzNzUwLCJpYXQiOjE3NzAwNDI4NTAsIm1lcmNoYW50X2lkIjoibWVyX2huNXY4MG1Dd0Q2MjI0IiwiZ3JhbnRfdHlwZSI6ImNsaWVudF9jcmVkZW50aWFscyIsImNsaWVudF9pZCI6ImNsaWVudF8zMjYyc053bVVQRnRwN3NndkU2Y20ifQ.SiIf7u96ANBU4RIbNLtJNfwgGs_S6p16bXK3HilvUhQ' \
--data '{
    "grantType": "client_credentials"
}'
```

**Response Sample**

```text
{
    "accessToken": "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJjZXhfYWdncmVnYXRvcl9zZXJ2aWNlIiwiZXhwIjoxNzcwMDQzNzUwLCJpYXQiOjE3NzAwNDI4NTAsIm1lcmNoYW50X2lkIjoibWVyX2huNXY4MG1Dd0Q2MjI0IiwiZ3JhbnRfdHlwZSI6ImNsaWVudF9jcmVkZW50aWFscyIsImNsaWVudF9pZCI6ImNsaWVudF8zMjYyc053bVVQRnRwN3NndkU2Y20ifQ.SiIf7u96ANBU4RIbNLtJNfwgGs_S6p16bXK3HilvUhQ",
    "expiryTime": "2026-02-02T14:49:10.276641426Z"
}
```

## [**â€‹**](https://ptnusantaraasethub.mintlify.app/api-reference/authentication#response-definition)

### 2. Handle Transaction Request Header

1. Generate Access token as part of header in the transaction API (Authorization)
2. Generate Transaction Signature as header information in transaction API (X-Signature). [Link for Access Token Header](/api-reference/authentication#transaction-request-header)
3. Hit Transaction API with proper header request and body format [Link for Transaction API Header](/api-reference/authentication#transaction-request-header)

### **3.  Crypto Deposits**

**3.1 Create Deposit Address**

If you are testing in sandbox mode, please make sure to include header of X-SANDBOX-DEPOSIT (number value) & X-SANDBOX-SIMULATE-TRX (completed/failed value) to create the success/ failed deposit transaction. This X-Header is not needed in production mode. X-SANDBOX-SIMULATE-TRX will also simulate webhook generation.
[Link for Deposit Transaction Sandbox Simulator](#crypto-deposit)


- **Request Sample:**

  ```
  curl --location 'https://api-sandbox.durian-x.com/v1.0/deposits/addresses' \
  --header 'X-SANDBOX-DEPOSIT: 100' \
  --header 'X-SANDBOX-SIMULATE-TRX: completed' \
  --header 'Content-Type: application/json' \
  --header 'Authorization: Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJjZXhfYWdncmVnYXRvcl9zZXJ2aWNlIiwiZXhwIjoxNzcwMDQ4MzM4LCJpYXQiOjE3NzAwNDc0MzgsIm1lcmNoYW50X2lkIjoibWVyX2huNXY4MG1Dd0Q2MjI0IiwiZ3JhbnRfdHlwZSI6ImNsaWVudF9jcmVkZW50aWFscyIsImNsaWVudF9pZCI6ImNsaWVudF8zMjYyc053bVVQRnRwN3NndkU2Y20ifQ.QiPUHl0Kx5Zpzgr6g-vyOPBaWlcYd9ZFDBZJ1s5zDiA' \
  --data '{
      "asset": "USDT",
      "network": "ERC20"
  }'
  ```

  **Response Sample:**

  ```
  {
      "id": "019c1f0d-0324-7b3e-9bf5-25d85b70df0c",
      "accountId": "019b968c-2bee-73f3-a7dd-c82f3a8558f7",
      "asset": "USDT",
      "network": "ERC20",
      "address": "0xe8afec6f32fe02375ff6f975cbafab435561858b",
      "expiredAt": "2026-02-05T15:51:12Z",
      "memo": "memo123"
  }
  ```

**3.2 Deposit Transaction Webhook Handling**

Once a deposit address is created, in sandbox mode, X-SANDBOX-SIMULATE-TRX & X-SANDBOX-DEPOSIT will allow you to simulate webhook creation to your endpoint with event of asset.deposited.

**Webhook Sample**

<CodeGroup>

```json asset.deposited: success
{
	"id": "uuidv7",
	"address": "0xabcdef0123456789",
	"amount" : "10000.112345",
	"network": "TRC20",
	"status": "completed",
	"createdAt": "2030-12-31T23:59:59+07:00",
	"finalStatusAt": "2030-12-31T23:59:59+07:00",
	"status": "completed",
	"txnHash": "0x12345678abcdef",
	"signature": "abcedefghijklmn"
}
```


```json asset.deposited: failed
{
	"id": "uuidv7",
	"address": "0xabcdef0123456789",
	"amount" : "10000.112345",
	"network": "TRC20",
	"createdAt": "2030-12-31T23:59:59+07:00",
	"finalStatusAt": "2030-12-31T23:59:59+07:00",
	"status": "failed",
	"failureReason": "failure reason here"
}
```

</CodeGroup>

**Important field to handle:**

- id for DurianX reference, amount as amount of deposit, accountId on
- Success case field:
  - status: completed
  - signature to be verified - [Link for Verifying Webhook Signature](/api-reference/transaction-notification-webhook#validate-webhook-signature)
  - txnHash as web3 receipt of your transaction
- Failed case field:
  - status: failed
  - signature to be verified - [Link for Verifying Webhook Signature](/api-reference/transaction-notification-webhook#validate-webhook-signature)
  - failureReason for the reason the transaction is failed

### **4. Quotes**

To execute swap (on/off-ramp) you will be required to quote rate to get current rate and lock the rate. Any quotes originally created will be in active status with transition to expired or used. Quote will have expiry time to be executed marked in expiredAt.
[Link for Quotes Sandbox Simulator](#quote)

**Request Sample:**

```shellscript
curl --location 'https://api-sandbox.durian-x.com/v1.0/quotes' \
--header 'X-SANDBOX-ERROR: QUOTE_INVALID_AMOUNT' \
--header 'Content-Type: application/json' \
--header 'Authorization: Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJjZXhfYWdncmVnYXRvcl9zZXJ2aWNlIiwiZXhwIjoxNzcwMDQ4MzM4LCJpYXQiOjE3NzAwNDc0MzgsIm1lcmNoYW50X2lkIjoibWVyX2huNXY4MG1Dd0Q2MjI0IiwiZ3JhbnRfdHlwZSI6ImNsaWVudF9jcmVkZW50aWFscyIsImNsaWVudF9pZCI6ImNsaWVudF8zMjYyc053bVVQRnRwN3NndkU2Y20ifQ.QiPUHl0Kx5Zpzgr6g-vyOPBaWlcYd9ZFDBZJ1s5zDiA' \
--data '{
    "sourceAsset": "USDT",
    "destinationAsset": "IDR",
    "sourceAmount": "100"
}'
```

**Response Sample:**

```json
{
    "id": "019c1f19-49fb-74f4-ad2d-d586eb264f61",
    "sourceAsset": "USDT",
    "sourceAmount": "100",
    "destinationAsset": "IDR",
    "destinationAmount": "1648300",
    "rate": "16483",
    "expiredAt": "2026-02-02T16:09:36Z",
    "status": "active"
}
```

**Important field to handle:**

- id : quoteId that will be brought at the swap (on/off ramp level)
- rate
- status
- expiredAt

### **5.  Swaps**

**Create Swap**

Use your active quote to execute a swap for the transaction. referenceId can be used to refer the swap transaction from your end. The created swap will have status of processing which will move to completed/failed
[Link for Swap Sandbox Simulator](#swap)

- **Request Sample**

  ```shellscript
  curl --location 'https://api-sandbox.durian-x.com/v1.0/swaps' \
  --header 'Content-Type: application/json' \
  --header 'Authorization: Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJjZXhfYWdncmVnYXRvcl9zZXJ2aWNlIiwiZXhwIjoxNzcwMDQ5NTM5LCJpYXQiOjE3NzAwNDg2MzksIm1lcmNoYW50X2lkIjoibWVyX2huNXY4MG1Dd0Q2MjI0IiwiZ3JhbnRfdHlwZSI6ImNsaWVudF9jcmVkZW50aWFscyIsImNsaWVudF9pZCI6ImNsaWVudF8zMjYyc053bVVQRnRwN3NndkU2Y20ifQ.nCzgPQhSOWn7uLXqcdySYBMflV_QMs6Q62UYjXIsWro' \
  --data '{
      "quoteId": "019c1f1e-fa9b-745b-b366-3d44281cfd18",
      "referenceId": "swap_mex_ref_1"
  }'
  ```
- **Response Sample**

  ```json
  {
      "id": "019c1f1f-206e-737c-8e44-919f18b83225",
      "quoteId": "019c1f1e-fa9b-745b-b366-3d44281cfd18",
      "referenceId": "swap_mex_ref_1",
      "sourceAsset": "USDT",
      "sourceAmount": "100",
      "destinationAsset": "IDR",
      "destinationAmount": "1648300",
      "rate": "16483",
      "status": "processing",
      "createdAt": "2026-02-02T16:10:59Z"
  }
  ```

**Swap Webhook handling**

Once a swap reach final status, webhook will be sent creation to your endpoint with event of swap.executed. In sandbox mode it will be immediately sent once you have successfuly created a swap transaction. 

## Error Handling and Edge Cases

### Response Definition

[Link for Response Definition](/api-reference/authentication#response-definition)

### Quote Expired

In case of a quote is expired, you cannot use it for the swap transaction. Therefore you need to handle from your end to re-quote in case of expired quote

### Failure and retry points

Here's the following failure & retry point you need to handle from your end

- Rate Expired -\> We recommend you handle this by re-quote the transaction and execute it with the newest quote
- Handling timeout when requesting a transaction
  - We recommend you to get the status of the transaction.
- Handling of timeout for transaction notification
  - We currently provide webhook retry. If you have configured the webhook URL, when ack is not received by us, we will retry the webhook for 5 times with exponential interval.
  - If there are any timeout for the transaction / webhook notification, we recommend you check the status of transaction using get API to update your internal status.

## How to test your implementation

- We provide sandbox environment for you to test your implementation before going live. Currently the sandbox environment is supported only via API
  - Sandbox Base URL: https://api-sandbox.durian-x.com/v1.0
- To simulate certain error cases in each of the API you can use the following header to simulate the transaction
  - X-SANDBOX-ERROR
  - X-SIMULATE-SANDBOX-TRX

## Sandbox limitations

- For Asset API we currently always set static balance information for the transaction. The balance will not be affected by sandbox transaction.
- For Asset Ledger API, it will be set as static sample of ledger. The ledger entry will not be affected by sandbox transaction.

## Simulating Edge Cases in Sandbox

### Crypto Deposit

| **Case Handling** | **Header Value**                                                              | **Output sample**                                                                                                                                    |
| :---------------- | :---------------------------------------------------------------------------- | :--------------------------------------------------------------------------------------------------------------------------------------------------- |
| Simulate success  | Header<br />X-SANDBOX-DEPOSIT = 100.1<br />X-SIMULATE-SANDBOX-TRX = completed | status code 200 OK<br /><br />In Deposit transaction, it will be marked as completed, Crypto deposit webhook will be sent to sandbox webhook url set |
| Simulate Failed   | Header<br />X-SANDBOX-DEPOSIT = 100.1<br />X-SIMULATE-SANDBOX-TRX = failed    | status code 200 OK<br /><br />In Deposit transaction, it will be marked as failed, Crypto deposit webhook will be sent to sandbox webhook url set    |

### Quote

| **Case Handling**    | **Header Value**                            | **Output sample** |
| :------------------- | :------------------------------------------ | :---------------- |
| Simulate success     | Any                                         | status code 201   |
| Invalid Quote Amount | Header Any.<br />Body: Set sourceAmount = 1 | status code 400   |

### Swap

| **Case Handling**             | **Header Value**                        | **Output Sample**                                                                                                                                      |
| :---------------------------- | :-------------------------------------- | :----------------------------------------------------------------------------------------------------------------------------------------------------- |
| Simulate Success              | without header value of X-SANDBOX-ERROR | status code 202<br /><br />In Swap transaction, it will be marked as success, swap executed webhook: completed will be sent to the sandbox webhook url |
| Simulate Insufficient Balance | X-SANDBOX-ERROR = INSUFFICIENT_BALANCE  | status code 422<br /><br />In Swap transaction, it will be marked as failed, swap executed webhook: failed will be sent to the sandbox webhook url     |
| Simulate Token is Expired     | X-SANDBOX-ERROR = QUOTE_EXPIRED         | status code 404<br /><br />In Swap transaction, it will be marked as failed, swap executed webhook: failed will be sent to the sandbox webhook url     |