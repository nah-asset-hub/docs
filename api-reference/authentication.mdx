---
icon: "key-skeleton-left-right"
title: "Authentication & Response Code"
---

## Overview

When you're calling any of DurianX API, you have to provide several parameter in the header. We will provide following details for you to authenticate your request:

- Client ID
- Client Secret
- Your Public Key: Generate your public key using steps provided in [Credential Setup](#credential-setup) section below
- Durianpay's Public Key: This will be used to validate our response's signature

## Credential Setup

### **Generate Private Key and Certificate Signing Request**

```shellscript
openssl genrsa -out ca.key 4096
openssl req -new -x509 -days 365 -key ca.key -out ca.crt -subj "/C=US/ST=CA/L=SF/O=RSA-2048 CA/OU=IT/CN=My Root RSA 4096 CA"

openssl genrsa -out client.key 4096
cat > client.ext <<EOF
authorityKeyIdentifier=keyid,issuer
basicConstraints=CA:FALSE
keyUsage=digitalSignature, keyEncipherment
extendedKeyUsage=clientAuth
subjectAltName=DNS:localhost
EOF
openssl req -new -key client.key -out client.csr -subj "/C=US/ST=CA/L=SF/O=MyOrg/OU=MyOU/CN=MyClient"
openssl x509 -req -in client.csr -CA ca.crt -CAkey ca.key -CAcreateserial -out client.crt -days 365 -extfile client.ext
```

2. Send your public key via e-mail to [support@durian-x.com](mailto:support@durian-x.com)
3. We will give you following password encrypted credential to connect with:
   1. **Client ID (X-Client-ID)**: Your autogenerated Client ID
   2. **Client Secret Key:** Your secret key will be use to generate signature for transactional API

## **Request Header**

Each Request requires specific header value. There are 2 kind of header for requests: to generate Access Token and to handle transaction

### **Access Token Header**

| **Header**   | **Description**            | **Format**            |
| :----------- | :------------------------- | :-------------------- |
| X-Timestamp  | Request timestamp ISO 8601 | datetime              |
| X-Signature  | Security signature         | Base64 encoded string |
| X-Client-ID  | Merchant Client ID         | String                |
| Content-Type | Type of data being sent    | MIME type             |

### **Transaction Request Header**

For On-ramp and Off-ramp Transaction we will check only for the following request headers

| **Header**    | **Description**         | **Format**                       |
| :------------ | :---------------------- | :------------------------------- |
| X-Timestamp   | Request timestamp       | ISO 8601 datetime                |
| X-Signature   | Security signature      | Base64 encoded string            |
| Content-Type  | Type of data being sent | MIME type (use application/json) |
| Authorization | Authorization token     | JWT (Started with 'Bearer ')     |

## Generate Signature

### **Generate Signature To Obtain Access Token (B2B)**

```json
<X-CLIENT-ID>|<X-TIMESTAMP> // (on ISO8601 format)
//Example: mer_123123|2024-05-13T14:53:06.991+07:00
```

which then signed using SHA256withRSA with Private Key and Client Certificate shared by Durianpay to merchant.

```json
X-Signature: aw3o6HM68vJDLO4nxAPgK0it5nd6zik3bUgMzqLiTrIB7w1QbnCLDo/IMVjaYsbPk9s=
```

- Sample Code - Go

  ```go
  package main
  
  import (
  	"crypto"
  	"crypto/rand"
  	"crypto/rsa"
  	"crypto/sha256"
  	"crypto/x509"
  	"encoding/base64"
  	"encoding/pem"
  	"fmt"
  	"io/ioutil"
  	"log"
  	"time"
  )
  
  // Custom timestamp formatter like Postman's script
  func toIsoString(t time.Time) string {
  	_, offset := t.Zone()
  	sign := "+"
  	if offset < 0 {
  		sign = "-"
  		offset = -offset
  	}
  	hours := offset / 3600
  	minutes := (offset % 3600) / 60
  
  	return fmt.Sprintf("%04d-%02d-%02dT%02d:%02d:%02d.%03d%s%02d:%02d",
  		t.Year(), t.Month(), t.Day(),
  		t.Hour(), t.Minute(), t.Second(), t.Nanosecond()/1e6,
  		sign, hours, minutes,
  	)
  }
  
  func main() {
  	// === CHANGE THIS ===
  	clientID := "your-client-id"
  	privateKeyPath := "./rsa_private_key.pem"
  
  	// Generate timestamp
  	timestamp := toIsoString(time.Now())
  	fmt.Println("Timestamp:", timestamp)
  
  	// Read and parse private key
  	privKeyBytes, err := ioutil.ReadFile(privateKeyPath)
  	if err != nil {
  		log.Fatalf("Failed to read private key file: %v", err)
  	}
  
  	block, _ := pem.Decode(privKeyBytes)
  	if block == nil || (block.Type != "PRIVATE KEY" && block.Type != "RSA PRIVATE KEY") {
  		log.Fatal("Failed to decode PEM block containing private key")
  	}
  
  	var privKey *rsa.PrivateKey
  	if block.Type == "PRIVATE KEY" {
  		key, err := x509.ParsePKCS8PrivateKey(block.Bytes)
  		if err != nil {
  			log.Fatalf("Failed to parse PKCS8 private key: %v", err)
  		}
  		privKey = key.(*rsa.PrivateKey)
  	} else {
  		key, err := x509.ParsePKCS1PrivateKey(block.Bytes)
  		if err != nil {
  			log.Fatalf("Failed to parse PKCS1 private key: %v", err)
  		}
  		privKey = key
  	}
  
  	// Create data to sign
  	data := clientID + "|" + timestamp
  	hashed := sha256.Sum256([]byte(data))
  
  	// Sign the hash
  	signature, err := rsa.SignPKCS1v15(rand.Reader, privKey, crypto.SHA256, hashed[:])
  	if err != nil {
  		log.Fatalf("Failed to sign data: %v", err)
  	}
  
  	// Encode in base64
  	sigBase64 := base64.StdEncoding.EncodeToString(signature)
  	fmt.Println("Signature (Base64):", sigBase64)
  }
  
  ```

### Generate Signature for Transactional API

You can find the required structure of the string to be encrypted as below:

```json
<HTTP METHOD> + ":" + <RELATIVE PATH URL> + ":" + <B2B ACCESS TOKEN> + ":" + LowerCase(HexEncode(SHA-256(Minify(<HTTP BODY>)))) + ":" + <X-TIMESTAMP>
  // Example: POST:/v1.0/balance-inquiry:eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJEdXJpYW4gTW9uZXkiLC :f806c49e8cd175aa9dd5dd8e0a49648c885954d:2024-05-13T15:07:07+07:00
```

which then encrypted using HMAC-SHA512 with merchant's Secret Key that Durianpay gave.

```http
X-Signature: tnNHFw5ZCWjnHFd9UGAB5iDLuwo+89efml8F1CP8vaqut/PfNWac/XLiCkLt3zGHTppZKPxz/PPptqM2alsOFA==
```

## Generate Access Token

<Note>
  B2B Access Token will be used for all transactional APIs. The token itself will have 900 seconds (15 minutes) valid time by default.
</Note>

<Note>
  There is no refresh access token nor the access token will be auto refreshed, so you will need to generate another access token if it has passed its expiry time
</Note>

**Request Sample**

```
curl --location 'https://api-sandbox.durian-x.com/v1.0/access-token' \
--header 'Content-Type: application/json' \
--header 'X-TIMESTAMP: 2024-05-13T15:32:36.422+07:00' \
--header 'X-SIGNATURE: KLJ9KthaIiZSzPqHUMuJRsKOZtYCqqWd5DhfWqYC7OjZ2Qlu0PvQ2wRQF5vfDWsz/qFYEexOXb47+oQBjMhAz4XRNhXBBfwoWxrGTG8iU8EYSDVfChW0NqAWjWIQolhB4UcHn5SybPFRON3rvAOIQTzuEshUA1PNAln8jOKaRmY=' \
--header 'Authorization: Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJjZXhfYWdncmVnYXRvcl9zZXJ2aWNlIiwiZXhwIjoxNzcwMDQzNzUwLCJpYXQiOjE3NzAwNDI4NTAsIm1lcmNoYW50X2lkIjoibWVyX2huNXY4MG1Dd0Q2MjI0IiwiZ3JhbnRfdHlwZSI6ImNsaWVudF9jcmVkZW50aWFscyIsImNsaWVudF9pZCI6ImNsaWVudF8zMjYyc053bVVQRnRwN3NndkU2Y20ifQ.SiIf7u96ANBU4RIbNLtJNfwgGs_S6p16bXK3HilvUhQ' \
--data '{
    "grantType": "client_credentials"
}'
```

**Response**

```
{
    "accessToken": "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJjZXhfYWdncmVnYXRvcl9zZXJ2aWNlIiwiZXhwIjoxNzcwMDQzNzUwLCJpYXQiOjE3NzAwNDI4NTAsIm1lcmNoYW50X2lkIjoibWVyX2huNXY4MG1Dd0Q2MjI0IiwiZ3JhbnRfdHlwZSI6ImNsaWVudF9jcmVkZW50aWFscyIsImNsaWVudF9pZCI6ImNsaWVudF8zMjYyc053bVVQRnRwN3NndkU2Y20ifQ.SiIf7u96ANBU4RIbNLtJNfwgGs_S6p16bXK3HilvUhQ",
    "expiryTime": "2026-02-02T14:49:10.276641426Z"
}
```

## **Response Definition**

### **Format**

- HTTP code response in Durianpay is following the standard defined byÂ [RFC 9110](https://httpwg.org/specs/rfc9110.html#overview.of.status.codes). Example: When doing request of swap transaction with the same X-External-ID twice, merchant will receive error with code 409 where:
  - 409 is HTTP code for Conflict
  - 00 together with 409 HTTP code indicates same X-External-ID or partnerReferenceNo is being used twice.Reference

### **Response Code List**

- Please refer to table below for list of Response Code, Response Message, and its meaning.

  **Successful Response**

  | **HTTP Code** | **Case Code** | **Response Message** | **Description**                             |
  | :------------ | :------------ | :------------------- | :------------------------------------------ |
  | 200           | SUCCESS       | Successful           | General Successful Result                   |
  | 201           | CREATED       | Resource Created     | Successsful                                 |
  | 202           | ACCEPTED      | Request Accepted     | Successful but transaction still on process |

  **Error Response**

  | **HTTP Code** | **Case Code**      | **Response Message**                                  | **Description**                                                                                                                                                                       | Handling                                                     |
  | :------------ | :----------------- | :---------------------------------------------------- | :------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------ | ------------------------------------------------------------ |
  | 400           | BAD_REQUEST        | Bad Request                                           | General request failed error, including message parsing failed.                                                                                                                       | Re-check the structure of the request body                   |
  | 400           | VALIDATION_ERROR   | Invalid Field Format or Value                         | Invalid format                                                                                                                                                                        | Re-check the structure of the request body                   |
  | 401           | UNAUTHORIZED       | Unauthorized [reason]                                 | General unauthorized error (No Interface Def, API is Invalid, Oauth Failed, Verify Client Secret Fail, Client Forbidden Access API, Unknown Client, Key not Found, Invalid Signature) | Re-check authorization handling from your end (Access Token) |
  | 403           | TRANSACTIONEXPIRED | Transaction Expired                                   | Transaction expired                                                                                                                                                                   |                                                              |
  | 404           | NOT_FOUND          | Entity or Transaction Not Found                       | Transaction not found                                                                                                                                                                 |                                                              |
  | 409           | CONFLICT           | Transaction already processed or Transaction Conflict | Cannot use same X-EXTERNAL-ID in same day                                                                                                                                             |                                                              |
  | 500           | GENERAL_ERROR      | General Error                                         | General Error                                                                                                                                                                         | Retry / Raise to NAH for the issue                           |
  | 500           | INTERNAL_ERROR     | Internal Server Error                                 | Unknown Internal Server Failure, Please inquiry the status or retry the process again                                                                                                 | Retry / Raise to NAH for the issue                           |
  | 504           | TIMEOUT            | Timeout                                               | Timeout from the issue                                                                                                                                                                | Retry / Raise to NAH for the issue                           |
- **Specific API Error**

  | API            | HTTP Error Code          | Code                       | Handling                                                                                   | Sample Error                                                                       |
  | :------------- | :----------------------- | :------------------------- | :----------------------------------------------------------------------------------------- | :--------------------------------------------------------------------------------- |
  | Create Deposit | 400 Bad Request          | BAD_REQUEST                | Check your body request and input the supported asset                                      | "code": BAD_REQUEST<br />"message: "Invalid request Asset Network"                 |
  | Create Swap    | 404 Not Found            | INSUFFICIENT_FUNDS         | Check your current account balance & deposit fund                                          | "code": INSUFFICIENT_FUNDS<br />"message: "insufficient balance on source asset"   |
  | Create Swap    | 422 Unprocessable Entity | QUOTE_NOT_FOUND_OR_EXPIRED | Quote is expired/ Not found, please re-generate new quote                                  | "code": "QUOTE_NOT_FOUND_OR_EXPIRED", "message": "quoteId is invalid or expired"   |
  | Create Quote   | 400 Bad Request          | QUOTE_INVALID_AMOUNT       | Quote is not within the amount limit, Please re-generate new quote within the amount limit | "code": "QUOTE_INVALID_AMOUNT", "message": "amount must be between 100 and 100000" |